# Technical Artist start kit

## 4. 그림자와 로컬 쉐이딩

### 4-1. 로컬 쉐이딩 

주변 정보를 고려하지 않고 그 지점에서의 정보만을 이용하는 쉐이딩 계산 방법. 

vs Global Illumination, GI

#### 4-1-1. 좋은 쉐이딩을 위해서는 

* 물리 법칙에 입각

### 4-2. 광원

* 쉐이딩과 그림자의 계산에는 광원 정보가 필수적 

#### 4-2-1. 광원의 종류와 특징

로컬 쉐이딩은 광원으로부터 직접 닿는 빛의 영향만을 고려.

**직접광**

광원에서 나와 직접 객체에 닿는 빛을 직접광(direct light)이라 지칭. 주로 디퓨즈 성분, 스펙큘러 성분의 계산에 사용

* 빛이 나오는 위치
* 빛의 진행 방향
* 거리에 따른 감쇠
* 각도에 따른 감쇠



**평행광원(Directional Light)**

태양으로부터의 빛을 평행광원이라고 간주할 수도 있지만, 완전히 평행한 빛은 현실 세계에는 존재하지 않음. 

그러나 계산이 간단하고 다루기 쉽기에 CG에서 널리 사용. 

빛이 나오는 위치는 정의되지 않음(굳이 말하자면 무한대)

시작 위치가 정해져 있지 않음, 그렇기에 거리 측정 불가, 따라서 거리에 따른 빛 강도의 감쇠가 없음.  

동일한 방향으로 이동하여 각도의 차이가 없기 때문에, 각도에 따른 빛 강도의 변화가 없음. 



**점광원(Point light)**

한 지점에서 방사형으로 뻗어 빛을 발하는 것. 

빛이 나오는 점에서 닿는 지점까지의 거리에 따라 빛의 강도를 감쇠 가능



**스포트광원(Spot light)**

점광원과 마찬가지로 한 점에서 직선으로 펼쳐지지만 일부 제한된 범위에만 빛을 발함. 



**면광원(Area light)**

여러 점광원들이 모여 있는 것으로 생각 가능. 



**간접광(Indirect light)**

광원에서 나온 빛이 객체에 직접 닿지 않고, 일단 다른 객체에 맞아 반사된 후 객체에 도달하는 빛을 간접광이라고 함. 

Global Illumnation이 바로 이 간접광을 계산하는 방법.

반사된 빛을 계산할 때에는 빛을 반사하는 면이 광원이 됨.

앞의 모든 광원에서 계산 가능



**앰비언트 광원(Ambient Light)**

주위의 공간 곳곳에서 닿는 빛을 환경광, 또는 앰비언트광이라고 함. 

환경광의 근사치 역할을 할 수 있음. 

이 광원의 특징은 모든 방향에서 동등하게 같은 양의 빛이 들어온다는 것, 이는 주위 물체에 반사되는 경로를 통해 다양한 방향에서 들어오면서 구현.  

ex) 빌딩 외벽에 비친 하늘의 푸른색 

쉐이딩 지점의 위치와 관계없이 모든 방향에서 동등하게 같은 양의 빛이 들어가므로 쉐이딩 결과도 균일한 색으로 타나며, 시점이 바껴도 이는 변하지 않음. 

로컬 쉐이딩으로 사용되는 앰비언트 광원은 이렇게 일정한 색상을 표현하도록 설계된 것이 많음. 전체적인 색을 합한 것 같은 균일한 빛을 발하는 광원으로 존재. 

#### 4-2-2. CG 광원 특유의 성질

* 감쇠없는 광원
* 어둡게 하는 광원
  * 덧셈 과정에서 뺄셈을 함으로써 가능
* 객체별 온/오프
* 성분별 온/오프 
  * 특정 성분(Ambient, Specular, Diffuse)에만 영향을 주고 다른 성분에는 영향을 주지 않는 빛 제작 가능

### 4-3. 물리와 로컬 쉐이딩

물리적으로 올바르지는 않아도 충분히 있을 것 같은 CG를 제작하는 것이 목표.

#### 4-3-1. 현실 세계에서의 현상 

로컬 쉐이딩은 간접광을 제대로 처리 불가

기본적으로 색번짐은 표현할 수 없음

 

**Subsurface Scattering**

빛이 객체 안에 들어가 내부에서 복잡한 반사를 거쳐 외부로 다시 방출되는 현상을 서브서피스 스캐터링이라고 함.

들어온 빛의 일부는 내부에서 산란을 반복하여 여러 다른 위치에서 밖으로 나감. 

CG에서는 근사계산을 함 

특히 실사 같은 느낌의 인간의 피부 렌더링을 하고자 할 때 SSS를 사용하지 않으면 자연스러운 결과를 얻기 힘듬.



#### 4-3-2. 쉐이딩 모델의 기본

쉐이딩 모델은 현실 세계에서 일어나는 빛의 현상을 컴퓨터에서 근사하기 위해 사용되는 일반적인 방법

쉐이딩 모델은 아래와 같은 정보를 이용하여 계산

* 객체 정보(법선, 접선, 색상 등)
* 광원 정보(방향, 색상 등)
* 카메라 정보(위치, 시선 등)

실제 계산이 가능하다 해도 컨트롤하기 어렵고, 계산에 오랜 시간이 소요되기 때문에 CG에서는 '단순화된 계산 모델에 의한 근사'를 사용



**<u>로컬 쉐이딩으로 표현 가능한 범위</u>**

* 반사 : 가능
* 산란 : 가능
* 빛을 열로 변환 : 근사 가능(에너지 시뮬레이션은 하지 않고 단순히 반사와 전달을 더한 결과를 원래의 빛보다 작아지게 만듬. 제대로 계산하려면 전달 모델과 객체를 전체적으로 생각해야 합니다.)
* 형광/인광 : 가능. 단, 빛의 복잡한 모델(스펙트럼 모델)이 필요.
* 투명 : 불가능
* 굴절 : 불가능
* 서브서피스 스캐터링 : 불가능

로컬 쉐이딩만으로는 표현력이 부족하므로 쉐이딩에 몇 가지 근사를 더해 일반적 쉐이딩 모델을 만들 필요가 있음.



**BRDF 반사 모델**

반사의 관계나 입사 방향과 반사 방향의 관계를 식으로 나타내는 것이 BRDF(Bidirectional Reflectance Distribution Function : 양방향 반사 분포 함수)

![f_{\text{r}}(documentOfTechnicalArtist.assets/49e75397f3740b44e763145f6c8c64578b2440e7.svg)\,=\,{\frac {\operatorname {d} L_{\text{r}}(\omega _{\text{r}})}{\operatorname {d} E_{\text{i}}(\omega _{\text{i}})}}\,=\,{\frac {\operatorname {d} L_{\text{r}}(\omega _{\text{r}})}{L_{\text{i}}(\omega _{\text{i}})\cos \theta _{\text{i}}\,\operatorname {d} \omega _{\text{i}}}}](https://wikimedia.org/api/rest_v1/media/math/render/svg/49e75397f3740b44e763145f6c8c64578b2440e7)



**로컬 쉐이딩에 기반한 일반적인 쉐이딩 모델**

투명 객체에 대응하지 못하고 간접 조명을 사용하지 않는 모델은 표현력이 매우 제한. 

로컬 쉐이딩에 근사치를 추가하여 높은 표현력을 지닌 쉐이딩 모델을 만들 필요가 있음. 



**<u>로컬 쉐이딩 기반 쉐이딩 모델</u>**

* BRDF 근사 조정 가능한 반사 모델 (로컬 쉐이딩 모델)
* 간접광의 근사(앰비언트 성분)
* 투명도의 근사(전달 모델)



**반사 모델**

CG에 사용하려는 객체의 BRDF 매개변수값을 모르는 경우도 존재

실사 같은 CG에선 BRDF가 유효, 애니메이션 같은 CG에서는 간단한 반사 모델로 근사

간단한 반사보델에서는 조정의 용이성과 표현의 자유도가 BRDF보다 높음

 로컬 쉐이딩에서는 반사 현상을 두 가지 성분으로 나누어 모델화

* 디퓨즈/확산 반사 성분 : 모든 방향으로 고르게 반사
* 스펙큘러/ 거울면 반사 성분 : 특정 방향으로만 강하게 일어나는 반사 